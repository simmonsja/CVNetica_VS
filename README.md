# CVNetica_VS
A Python package to perform wrapper-based variable selection and cross-validation on Bayesian Networks using Netica

*Written by Joshua Simmons and Tomas Beuzen extending the functionality of CVNetica*

## Description
Bayesian Networks (BNs) are useful methods of probabilistically modelling environmental systems. BN performance is sensitive to the number of variables included in the model framework. The selection of the optimum set of variables to include in a BN (“Variable Selection”) is therefore a key part of the BN modelling process. While variable selection is an issue dealt with in the wider BN and machine learning literature, it remains largely absent from environmental BN applications to date, due in large part to a lack of software designed to work with available BN packages. CVNetica_VS is an open-source Python module that extends the functionality of Netica, a commonly used commercial BN software package, to perform variable selection. CVNetica_VS uses wrapper-based variable selection and cross-validation to search for the optimum variable set to use in a BN. The software will aid in objectifying and automating the development of BNs in environmental applications.

This package is an extension of the [CVNetica](https://github.com/mnfienen-usgs/CVNetica) package developed by [Fienen and Plant (2015)](https://doi.org/10.1016/j.envsoft.2014.09.007).

## Use
A demonstration of the use of CVNetica_VS is provided in the Jupyter Notebook *CVNetica_VS_EXAMPLE.ipynb*.

The main function to run CVNetica_VS is provided as *run_CV* in *CVNetica_VS_run.py*. *run_CV* takes as a single argument a Python dictionary containing settings specified by the user as shown in the example notebook. The user must provide the path to a Netica BN (with or without directed arcs and as a Netica .neta file) to the *baseNET* key. This BN should contain all input and response variables. Any existing connections between nodes are removed, new BNs are constructed connecting only the subset variables of interest in each case, and their conditional probability tables (CPTs) are re-trained using the provided data (contained in a Netica .cas file) on the path provided to the key *baseCAS*. Counting-learning is the default method for learning CPTs in Netica. The key *voodooPar* can be used to tune CPT learning when using counting-learning. Expectation maximisation can instead be used to learn CPTs using the key *EMflag*. If the user has a license file for the full version of Netica, it can be provided to the key *pwdfile*; alternatively, providing a dummy file name (e.g., ‘NA.txt’) will allow use of the free version of Netica.

To undertake variable selection, the input and response variables are set using the keys input_vars and response_vars respectively. The key *combinations* is a list of integers that specifies what input variables subsets CVNetica_VS should test, e.g., all combinations of 1, 2, and 3 input variables. All BNs constructed by CVNetica_VS are temporarily stored and run in the directory specified to the key *working_dir*. Cross-validation (CV) can be undertaken when testing each CVNetica_VS subset BN by setting the *CVflag* key to true and specifying the number of desired folds using the key *numfolds*. If the *CVflag* is set to false, each BN is trained and tested on the full dataset. CVNetica_VS collects the performance metrics of each variable subset and these metrics are output to a .csv file at a path specified using the key *output_file*. The verbosity of CVNetica_VS can be set using the *verboselvl* key with a smaller value providing less information. Additionally, to maintain the cleanliness of the output space any warnings produced while running CVNetica_VS are sent to the file warnings.txt by setting the key *warningtofile* to true.

As shown in the example Jupyter Notebook, these settings can be provided to the function *run_VS* which will initialise a Netica environment, build all the possible network configurations (e.g., input and response variable combinations) specified by the user, and run these configurations. This function returns a *scenario_store* class (from *CVNetica_VS_tools*) which contains (for each BN built) the path to the network, and information on the input and response nodes. It also returns a *performance_store module* (from *CVNetica_VS_tools*) which contains a Pandas DataFrame object containing tabular data with true/false values reflecting the presence of each input and response node, and values for various performance metrics, for each of the combinations. The data can also be viewed in the .csv file specified to *output_file* where output metrics are provided alongside the input and response variables to determine the most skilful or accurate combinations.

## Issues and contributions
Have you found an issue with the code and need to get it fixed? Or perhaps you're looking to contribute to the code and looking for ways it could be improved. In both cases, please see the [Issues page](https://github.com/simmonsja/CVNetica_VS/issues).
